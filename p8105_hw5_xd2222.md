p8105 homework 5
================
Xintao Ding
11/9/2019

## Problem 1

write a function that takes a vector as an argument; replaces missing
values using the rules defined above; and returns the resulting
vector;apply this function to the columns of iris\_with\_missing using a
map statement

``` r
set.seed(10)
iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

#define a function
missing_values_replacement = function(x) {
  if(is.numeric(x)) {
    replace(x, is.na(x), mean(x, na.rm = TRUE)) #replace numeric missing values with mean 
  } else if (is.character(x)) {
    replace(x, is.na(x), "virginica")   #replace character missing values with a certain word
}
  }

iris_withnot_missing = map_dfr(iris_with_missing, missing_values_replacement) # map the function to iris_with_missing
iris_withnot_missing
```

    ## # A tibble: 150 x 5
    ##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
    ##           <dbl>       <dbl>        <dbl>       <dbl> <chr>  
    ##  1         5.1          3.5         1.4         0.2  setosa 
    ##  2         4.9          3           1.4         0.2  setosa 
    ##  3         4.7          3.2         1.3         0.2  setosa 
    ##  4         4.6          3.1         1.5         1.19 setosa 
    ##  5         5            3.6         1.4         0.2  setosa 
    ##  6         5.4          3.9         1.7         0.4  setosa 
    ##  7         5.82         3.4         1.4         0.3  setosa 
    ##  8         5            3.4         1.5         0.2  setosa 
    ##  9         4.4          2.9         1.4         0.2  setosa 
    ## 10         4.9          3.1         3.77        0.1  setosa 
    ## # … with 140 more rows

## Problem 2

``` r
# create a dataframe with list file names
file_name <- list.files("./data") 
df <- tibble(file_name)
df <- df %>% 
  mutate(outcome = map(file_name, ~read_csv(str_c("./data/", .x)))) # iterate file names and save as a new variable
df
```

    ## # A tibble: 20 x 2
    ##    file_name  outcome         
    ##    <chr>      <list>          
    ##  1 con_01.csv <tibble [1 × 8]>
    ##  2 con_02.csv <tibble [1 × 8]>
    ##  3 con_03.csv <tibble [1 × 8]>
    ##  4 con_04.csv <tibble [1 × 8]>
    ##  5 con_05.csv <tibble [1 × 8]>
    ##  6 con_06.csv <tibble [1 × 8]>
    ##  7 con_07.csv <tibble [1 × 8]>
    ##  8 con_08.csv <tibble [1 × 8]>
    ##  9 con_09.csv <tibble [1 × 8]>
    ## 10 con_10.csv <tibble [1 × 8]>
    ## 11 exp_01.csv <tibble [1 × 8]>
    ## 12 exp_02.csv <tibble [1 × 8]>
    ## 13 exp_03.csv <tibble [1 × 8]>
    ## 14 exp_04.csv <tibble [1 × 8]>
    ## 15 exp_05.csv <tibble [1 × 8]>
    ## 16 exp_06.csv <tibble [1 × 8]>
    ## 17 exp_07.csv <tibble [1 × 8]>
    ## 18 exp_08.csv <tibble [1 × 8]>
    ## 19 exp_09.csv <tibble [1 × 8]>
    ## 20 exp_10.csv <tibble [1 × 8]>

``` r
# tidy data frame
tidy_df <- df %>% 
  separate(file_name, into = c("arm", "subject_id"), sep = "_") %>% 
  mutate (subject_id = gsub("\\.csv", "", subject_id)) %>%  # include subject ID
  unnest() %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "outcome"
  )
  
tidy_df
```

    ## # A tibble: 160 x 4
    ##    arm   subject_id week   outcome
    ##    <chr> <chr>      <chr>    <dbl>
    ##  1 con   01         week_1    0.2 
    ##  2 con   01         week_2   -1.31
    ##  3 con   01         week_3    0.66
    ##  4 con   01         week_4    1.96
    ##  5 con   01         week_5    0.23
    ##  6 con   01         week_6    1.09
    ##  7 con   01         week_7    0.05
    ##  8 con   01         week_8    1.94
    ##  9 con   02         week_1    1.13
    ## 10 con   02         week_2   -0.88
    ## # … with 150 more rows

``` r
# plotting
plot <- tidy_df %>% 
  ggplot(aes(x = week, y = outcome, group = subject_id, color = subject_id)) +
  geom_line()+
  facet_grid(~arm)+
  labs(title = "Observatinos on Each Subject over Time")
plot
```

<img src="p8105_hw5_xd2222_files/figure-gfm/unnamed-chunk-2-1.png" width="90%" />
Subjects in control arm have overall lower outcomes than those of
subjects in the experimental arm. Subjects in the experimantal arm also
see a bigger variance in outcome over 8 weeks, whereas subjects in the
control arm have outcomes that do not fluctuate much over the 8 week
course.

\#\#Problem 3

``` r
sim_regression = function(n = 30, beta0 = 2, beta1){
  sim_data = tibble (
    x = rnorm(n, mean = 0, sd = 1),
    y = beta0 + beta1 * x + rnorm(n, 0, sd = sqrt(50))
  )
  ls_fit <-  lm(y ~ x, data = sim_data) %>% 
    broom::tidy() %>% 
    select(term, estimate, p.value) %>% 
    filter(term == "x") %>% 
    mutate(term = recode(term, "x" = "beta1_hat"))
  
}

output = rerun(1000, sim_regression(beta1 = 0)) %>% 
  bind_rows()
output
```

    ## # A tibble: 1,000 x 3
    ##    term      estimate  p.value
    ##    <chr>        <dbl>    <dbl>
    ##  1 beta1_hat    2.02  0.207   
    ##  2 beta1_hat    1.23  0.182   
    ##  3 beta1_hat    0.603 0.606   
    ##  4 beta1_hat    3.03  0.000149
    ##  5 beta1_hat   -1.19  0.471   
    ##  6 beta1_hat   -1.49  0.219   
    ##  7 beta1_hat   -1.97  0.192   
    ##  8 beta1_hat    0.331 0.769   
    ##  9 beta1_hat    0.576 0.670   
    ## 10 beta1_hat    2.40  0.134   
    ## # … with 990 more rows

``` r
beta1_list <- list(1:6)
output_list <- vector("list", length = 6)
for (i in beta1_list) {
  output_list[[i]] = rerun(1000, sim_regression(beta1 = beta1_list[i]))
}
```

    ## Error in beta1 * x: non-numeric argument to binary operator

``` r
output_total <- output_list %>% 
  bind_row()
```

    ## Error in bind_row(.): could not find function "bind_row"

``` r
output_total
```

    ## Error in eval(expr, envir, enclos): object 'output_total' not found
